<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Beatmaker</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="container">
    <h1>Super Beatmaker</h1>
    
    <!-- Setup Screen -->
    <div id="setup-screen">
      <div class="card">
        <h2>New Run</h2>
        <div class="grid" style="margin-top: 0.5rem;">
          <label>
            Mode
            <select id="mode-select">
              <option value="normal">Normal</option>
              <option value="hard">Hard Mode</option>
              <option value="casual">Casual Mode</option>
              <option value="cursed">Cursed Mode</option>
              <option value="seeded">Seeded Run</option>
              <option value="quick">Quick Room</option>
            </select>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="manual-track-type">
            Manual Track Type Selection
          </label>
          <button id="start-run">Enter the Dungeon</button>
        </div>
      </div>
      
      <div class="card">
        <h2>Continue Run</h2>
        <div class="flex">
          <button id="continue-run" class="secondary" disabled>Continue Saved Run</button>
          <button id="import-btn" class="secondary">Import</button>
          <input type="file" id="import-input" accept=".json">
        </div>
      </div>
    </div>
    
    <!-- Game Screen -->
    <div id="game-screen" class="hidden">
      <div class="card">
        <div class="flex-between">
          <div>
            <span class="badge">Room <span id="room-number">1</span></span>
            <span class="badge powerup">Power-Ups: <span id="powerup-count">0</span></span>
            <span id="conditional-badge" class="badge warning hidden">USE OR LOSE!</span>
            <span class="badge" id="mode-badge">Normal</span>
            <span id="timer" class="badge timer hidden">5:00</span>
          </div>
          <div class="flex">
            <button id="cheatsheet-btn" class="small secondary">Rules</button>
            <button id="export-btn" class="small secondary">Export</button>
            <button id="end-run" class="small danger">End Run</button>
          </div>
        </div>
      </div>
      
      <!-- Current Room -->
      <div id="room-panel" class="card">
        <h2>Room <span id="current-room">1</span></h2>
        <div id="room-content"></div>
      </div>
      
      <!-- Power-Ups Panel -->
      <div id="powerup-panel" class="card hidden">
        <h2>Use Power-Up</h2>
        <p class="muted" style="margin-bottom: 0.5rem;">Optional - game continues without using one</p>
        <div class="grid grid-2">
          <button class="secondary powerup-btn" data-type="redirect">Curse Redirect</button>
          <button class="secondary powerup-btn" data-type="lock">Room Lock</button>
          <button class="secondary powerup-btn" data-type="painshift">Pain Shift</button>
          <button class="secondary powerup-btn" data-type="split">Split the Wound</button>
          <button class="secondary powerup-btn" data-type="breath">One Last Breath</button>
        </div>
      </div>
      
      <!-- Tracks List -->
      <div class="card">
        <h2>Tracks</h2>
        <div id="tracks-list" class="grid"></div>
        <p id="no-tracks" class="muted" style="color: var(--muted);">No tracks yet.</p>
      </div>
      
      <!-- Log -->
      <div class="card">
        <h2>Run Log</h2>
        <div id="log" class="log"></div>
      </div>
    </div>
    
    <!-- End Screen -->
    <div id="end-screen" class="hidden">
      <div class="card">
        <h2>Run Complete</h2>
        <div id="run-summary"></div>
        <h3 style="margin-top: 1rem;">Tags</h3>
        <div id="run-tags" class="tags"></div>
        <div class="flex" style="margin-top: 1rem;">
          <button id="new-run">New Run</button>
          <button id="export-final" class="secondary">Export Run</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cheat Sheet Modal -->
  <div id="cheatsheet-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Super Beatmaker Rules</h2>
        <button id="close-cheatsheet" class="small secondary">Close</button>
      </div>
      <div class="modal-body">
        <h3>System Flow</h3>
        <ol>
          <li>Declare Track Type</li>
          <li>Curse Check (01-70: No Curse, 71-98: Target Curse, 99-100: Mix Curse)</li>
          <li>Roll Mutation</li>
          <li>Compose Track</li>
          <li>Room Finalizes</li>
          <li>Roll for Power-Up (if did not use)</li>
        </ol>

        <h3>Power-Ups</h3>
        <ul>
          <li><strong>Curse Redirect:</strong> Reroll what Track receives a Curse</li>
          <li><strong>Room Lock:</strong> (1/Run) Prevent a Track from future Target Curses</li>
          <li><strong>Pain Shift:</strong> (Room 4+) No Mutation, guaranteed Target Curse</li>
          <li><strong>Split the Wound:</strong> Apply curse to 2 Tracks at half strength</li>
          <li><strong>One Last Breath:</strong> (1/Run) Reverse one Curse, force final Room</li>
        </ul>

        <h3>Earning Power-Ups</h3>
        <p>After Room without using Power-Up:</p>
        <ul>
          <li>01-75: None</li>
          <li>76-85: +1 Power-Up</li>
          <li>86-97: +1 Conditional (must use next room or lose it + can't earn next room)</li>
          <li>98-100: +2 Power-Ups</li>
        </ul>

        <h3>Curse Target (2 rolls)</h3>
        <p><strong>First:</strong> 01-20: Previous, 21-40: Oldest, 41-60: Loudest, 61-80: Quietest, 81-95: Choice, 96-100: Two Targets</p>
        <p><strong>Second:</strong> 01-32: Track Before, 33-66: That Track, 67-100: Track After</p>

        <h3>Mutations (d100)</h3>
        <div class="table-scroll">
          <table>
            <tr><th>Roll</th><th>Effect</th></tr>
            <tr><td>01-02</td><td>Sum the Track to mono.</td></tr>
            <tr><td>03-04</td><td>Track must be monophonic.</td></tr>
            <tr><td>05-06</td><td>Limited to one octave or four slices.</td></tr>
            <tr><td>07-08</td><td>Tracks/Slices must be fixed velocity.</td></tr>
            <tr><td>09-10</td><td>Track must loop one bar over and over.</td></tr>
            <tr><td>11-12</td><td>May only play on beats 1 and 3.</td></tr>
            <tr><td>13-14</td><td>May only play on beats 2 and 4.</td></tr>
            <tr><td>15-16</td><td>Must be played or sequenced in triplets.</td></tr>
            <tr><td>17-18</td><td>Must not be quantized; must be played live.</td></tr>
            <tr><td>19-20</td><td>Must be quantized to 1/16 steps.</td></tr>
            <tr><td>21-22</td><td>Notes must be sequenced in step sequence.</td></tr>
            <tr><td>23-24</td><td>Notes/slices can't be edited once performed or programmed.</td></tr>
            <tr><td>25-26</td><td>Cannot be re-sequenced after Room resolves. Can only delete notes/slices.</td></tr>
            <tr><td>27-28</td><td>Must be altered and resampled before processing.</td></tr>
            <tr><td>29-30</td><td>Shorten envelope to be percussive.</td></tr>
            <tr><td>31-32</td><td>Must use one sound or note only.</td></tr>
            <tr><td>33-34</td><td>Cannot use the same note or slice twice.</td></tr>
            <tr><td>35-36</td><td>Notes must be played in strict order.</td></tr>
            <tr><td>37-38</td><td>Every note must repeat once before another may be played.</td></tr>
            <tr><td>39-40</td><td>There can be no silence in the Track.</td></tr>
            <tr><td>41-42</td><td>Must pass through reverb before composing.</td></tr>
            <tr><td>43-44</td><td>Must pass through delay before composing.</td></tr>
            <tr><td>45-46</td><td>May not use effects.</td></tr>
            <tr><td>47-48</td><td>May use only one effect.</td></tr>
            <tr><td>49-50</td><td>Must be side-chained to the previous Track.</td></tr>
            <tr><td>51-52</td><td>Must be noise-gated.</td></tr>
            <tr><td>53-54</td><td>Must pass through a low-pass filter (1 kHz).</td></tr>
            <tr><td>55-56</td><td>Must be detuned slightly (±10 cents).</td></tr>
            <tr><td>57-58</td><td>You can't audition sounds. Pick blind before composing.</td></tr>
            <tr><td>59-60</td><td>All effects must be added and tuned before composing.</td></tr>
            <tr><td>61-62</td><td>Mute all rhythms and the metronome for the duration of the Room.</td></tr>
            <tr class="highlight"><td>63-64</td><td>Roll twice. Apply both Mutations.</td></tr>
            <tr><td>65-66</td><td>Only apply effects that have already been used.</td></tr>
            <tr><td>67-68</td><td>Must include one deliberate wrong note.</td></tr>
            <tr><td>69-70</td><td>No Mutation.</td></tr>
            <tr class="highlight"><td>71-72</td><td>Track must abandon its intended Track Type.</td></tr>
            <tr><td>73-74</td><td>Solo this Track for the duration of the Room.</td></tr>
            <tr><td>75-76</td><td>Only use effects that haven't been used.</td></tr>
            <tr><td>77-78</td><td>Once Room is finalized, volume is locked.</td></tr>
            <tr><td>79-80</td><td>No Mutation.</td></tr>
            <tr class="highlight"><td>81-82</td><td>Purpose of Track changes to match previous Room. If Room One, re-roll.</td></tr>
            <tr class="highlight"><td>83-84</td><td>Repeat last Room's Mutation. If first Room, no Mutation.</td></tr>
            <tr class="highlight"><td>85-86</td><td>Once you begin composing, the Room finalizes in five minutes.</td></tr>
            <tr><td>87-88</td><td>Must control same amount of notes as previous Track.</td></tr>
            <tr><td>89-90</td><td>Compose Track while muted. Select sounds/patches before unmuting. Unmute ends Room.</td></tr>
            <tr class="highlight"><td>91-92</td><td>Each note requires deleting one note from another Track. If Room One, no Mutation.</td></tr>
            <tr class="highlight"><td>93-94</td><td>Take a Target Curse instead.</td></tr>
            <tr><td>95-96</td><td>Once a note or slice is placed, it can't be moved—only deleted.</td></tr>
            <tr class="highlight"><td>97-98</td><td>Roll Mutations 80 or higher = delete Track. If Room One, no Mutation.</td></tr>
            <tr><td>99-100</td><td>No Mutation.</td></tr>
          </table>
        </div>

        <h3>Target Curses (d100)</h3>
        <div class="table-scroll">
          <table>
            <tr><th>Roll</th><th>Effect</th></tr>
            <tr><td>01-04</td><td>Mute until end of Run.</td></tr>
            <tr><td>05-08</td><td>Collapse to mono.</td></tr>
            <tr><td>09-12</td><td>1/32 quantize.</td></tr>
            <tr><td>13-16</td><td>Pan hard left or right.</td></tr>
            <tr><td>17-20</td><td>Track must remain constant in final arrangement.</td></tr>
            <tr><td>21-24</td><td>Resample, Chop, Reverse, Re-sequence.</td></tr>
            <tr><td>25-28</td><td>Pitch shift one octave.</td></tr>
            <tr><td>29-32</td><td>Apply Flanger or Chorus.</td></tr>
            <tr class="highlight"><td>33-36</td><td>Force a Room. Next Room will have two Mutations.</td></tr>
            <tr><td>37-40</td><td>Turn Track down -6 dB.</td></tr>
            <tr><td>41-44</td><td>Strip all effects.</td></tr>
            <tr class="highlight"><td>45-48</td><td>This Track is now target of all future Curses until end of Run.</td></tr>
            <tr><td>49-52</td><td>Over-compress.</td></tr>
            <tr><td>53-56</td><td>When discarding Run, roll d100. On 51+, force another Room.</td></tr>
            <tr class="highlight"><td>57-60</td><td>Delete Track. You can't replace its role.</td></tr>
            <tr><td>61-64</td><td>No re-sequencing or volume change.</td></tr>
            <tr><td>65-68</td><td>Remove half the notes/chops.</td></tr>
            <tr><td>69-72</td><td>Loop a short segment.</td></tr>
            <tr><td>73-76</td><td>Erase all notes/slices except first and last.</td></tr>
            <tr><td>77-80</td><td>This Track can't loop back to back.</td></tr>
            <tr><td>81-84</td><td>Delete the first bar of the Track.</td></tr>
            <tr><td>85-88</td><td>Delete the last bar of the Track.</td></tr>
            <tr><td>89-92</td><td>Cannot edit Track rest of Run.</td></tr>
            <tr class="highlight"><td>93-96</td><td>Apply last Curse to another Track of your choosing. If first Curse, ignore.</td></tr>
            <tr class="highlight"><td>97-100</td><td>Re-roll twice.</td></tr>
          </table>
        </div>

        <h3>Mix Curses (d100, only on 99-100 curse check)</h3>
        <div class="table-scroll">
          <table>
            <tr><th>Roll</th><th>Effect</th></tr>
            <tr class="highlight"><td>01</td><td>This is the last Room. If Room One or Two, re-roll.</td></tr>
            <tr><td>02-07</td><td>Delay on Entire Mix.</td></tr>
            <tr><td>08-14</td><td>No quantize for rest of Run. All notes performed live.</td></tr>
            <tr><td>15-21</td><td>1/32 quantize for rest of Run.</td></tr>
            <tr><td>22-28</td><td>Decrease BPM by 10.</td></tr>
            <tr><td>29-35</td><td>Increase BPM by 10.</td></tr>
            <tr><td>36-42</td><td>Reverb on Entire Mix.</td></tr>
            <tr><td>43-49</td><td>Resample Entire Mix. Disable all other Tracks.</td></tr>
            <tr><td>50-56</td><td>Tracks can no longer resample unless instructed by Curse/Mutation.</td></tr>
            <tr><td>57-63</td><td>Adjust your Monitoring. Cannot change for rest of Run.</td></tr>
            <tr><td>64-70</td><td>You cannot adjust volume of previous Tracks.</td></tr>
            <tr><td>71-77</td><td>Automation is now banned.</td></tr>
            <tr><td>78-84</td><td>Mix must be summed to mono.</td></tr>
            <tr><td>85-91</td><td>Only previously used effects can be used until end of Run.</td></tr>
            <tr class="highlight"><td>92-100</td><td>Roll three Target Curses.</td></tr>
          </table>
        </div>

        <h3>End Condition</h3>
        <p>Run ends when you declare it over with no forced Rooms. If rules followed, you win!</p>
      </div>
    </div>
  </div>

  <script type="module" src="./main.js"></script>
</body>
</html>
